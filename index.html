<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ä¸œå—äºšè·¨å¢ƒå®šä»·è®¡ç®—å™¨</title>
  <meta name="description" content="å‚æ•°å¯é…ç½® Â· æ”¯æŒ Shopee / Lazada / TikTok">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f8f9fa;
      color: #333;
      line-height: 1.5;
    }
    .container {
      display: flex;
      max-width: 1200px;
      margin: 0 auto;
      min-height: 100vh;
      box-shadow: 0 0 20px rgba(0,0,0,0.08);
      background: white;
    }
    .input-panel {
      flex: 0 0 60%;
      padding: 30px;
      background: #fff;
      border-right: 1px solid #eee;
    }
    .input-panel h1 {
      color: #ee4d2d;
      margin-bottom: 25px;
      font-size: 24px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 25px;
      font-size: 14px;
    }
    .form-group { margin-bottom: 20px; }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #444;
    }
    input, select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 15px;
    }
    .note { font-size: 13px; color: #888; margin-top: 5px; }
    button {
      width: 100%;
      padding: 14px;
      background: #ee4d2d;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 17px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 10px;
    }
    button:hover { background: #d03a1f; }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .result-panel {
      flex: 0 0 40%;
      padding: 30px;
      background: #fafafa;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .result-placeholder {
      text-align: center;
      color: #999;
      padding: 20px;
    }
    .result-box {
      background: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      border-left: 4px solid #ee4d2d;
    }
    .result-item { margin-bottom: 15px; }
    .result-label { font-size: 14px; color: #666; margin-bottom: 4px; }
    .result-value { font-size: 18px; font-weight: bold; color: #333; }
    .final-price { font-size: 24px; color: #e74c3c; margin: 10px 0; }
    .local-price { font-size: 20px; color: #2c3e50; font-weight: bold; }

    @media (max-width: 768px) {
      .container { flex-direction: column; min-height: auto; }
      .input-panel, .result-panel { flex: none; width: 100%; padding: 20px; }
      .input-panel { border-right: none; border-bottom: 1px solid #eee; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="input-panel">
      <h1>ğŸŒ ä¸œå—äºšè·¨å¢ƒå®šä»·è®¡ç®—å™¨</h1>
      <p class="subtitle">å‚æ•°ç”± config.json åŠ¨æ€åŠ è½½ Â· å¯éšæ—¶ä¿®æ”¹</p>

      <div class="form-group">
        <label for="site">é€‰æ‹©å¹³å°ä¸ç«™ç‚¹</label>
        <select id="site" disabled>
          <option value="">åŠ è½½ä¸­...</option>
        </select>
      </div>

      <div class="form-group">
        <label>é‡‡è´­æˆæœ¬ï¼ˆå…ƒï¼‰</label>
        <input type="number" id="cost" placeholder="ä¾‹å¦‚ï¼š30.00" step="0.01" value="30">
      </div>

      <div class="form-group">
        <label>å•†å“é‡é‡ï¼ˆå…‹ï¼‰</label>
        <input type="number" id="weight" placeholder="ä¾‹å¦‚ï¼š150" value="150" min="1">
        <div class="note">è‡ªåŠ¨è®¡ç®—å¹²çº¿ç‰©æµ</div>
      </div>

      <div class="form-group">
        <label>åŒ…è£…æˆæœ¬ï¼ˆå…ƒï¼‰</label>
        <input type="number" id="packaging" placeholder="ä¾‹å¦‚ï¼š1.00" step="0.01" value="1">
      </div>

      <div class="form-group">
        <label>ç›®æ ‡åˆ©æ¶¦ç‡ï¼ˆ%ï¼‰</label>
        <input type="number" id="profit" placeholder="ä¾‹å¦‚ï¼š30" value="30">
      </div>

      <div class="form-group">
        <label>è¥é”€è´¹ç”¨ï¼ˆå¹¿å‘Š/ä¼˜æƒ åˆ¸ï¼Œå…ƒï¼‰</label>
        <input type="number" id="marketing" placeholder="ä¾‹å¦‚ï¼š2.00" step="0.01" value="0">
        <div class="note">å¤§ä¿ƒæ—¶å»ºè®®è®¾ä¸º 0</div>
      </div>

      <div class="form-group" id="custom-fields" style="display:none;">
        <label>å¹³å°ä½£é‡‘ï¼ˆ%ï¼‰</label>
        <input type="number" id="commission" value="5" step="0.1">
        <label>äº¤æ˜“æ‰‹ç»­è´¹ï¼ˆ%ï¼‰</label>
        <input type="number" id="fee" value="2" step="0.1">
        <label>æœåŠ¡è´¹ï¼ˆ%ï¼‰</label>
        <input type="number" id="serviceFee" value="0" step="0.1">
        <label>æ±‡ç‡ï¼ˆ1 CNY = ? æœ¬åœ°å¸ï¼‰</label>
        <input type="number" id="exchange" value="3700" step="1">
      </div>

      <button id="calcBtn" onclick="calculate()" disabled>ğŸš€ ç«‹å³è®¡ç®—å»ºè®®å”®ä»·</button>
    </div>

    <div class="result-panel">
      <div id="result-placeholder" class="result-placeholder">
        <p>å¡«å†™å·¦ä¾§å‚æ•°<br>ç‚¹å‡»â€œç«‹å³è®¡ç®—â€<br>æŸ¥çœ‹å®šä»·å»ºè®®</p>
      </div>
      <div id="result-box" class="result-box" style="display:none;">
        <div class="result-item">
          <div class="result-label">ğŸ“¦ æ€»æˆæœ¬</div>
          <div class="result-value" id="totalCost">â€”</div>
        </div>
        <div class="result-item">
          <div class="result-label">ğŸ¯ ç›®æ ‡å‡€æ”¶å…¥</div>
          <div class="result-value" id="targetNet">â€”</div>
        </div>
        <div class="result-item">
          <div class="result-label">ğŸ’¡ å»ºè®®ä¸Šæ¶ä»·ï¼ˆäººæ°‘å¸ï¼‰</div>
          <div class="final-price" id="finalPriceRMB">â€”</div>
        </div>
        <div class="result-item">
          <div class="result-label">ğŸŒ æœ¬åœ°è´§å¸å»ºè®®ä»·</div>
          <div class="local-price" id="localPrice">â€”</div>
        </div>
        <div style="margin-top:20px; font-size:13px; color:#777;">
          âœ… å·²å«ï¼šå¹³å°è´¹ + å¹²çº¿ç‰©æµ<br>
          ğŸ’¡ ä»·æ ¼å·²ä¼˜åŒ–ä¸º .99 ç»“å°¾
        </div>
      </div>
    </div>
  </div>

  <script>
    let CONFIG = null;

    // åŠ è½½é…ç½®
    async function loadConfig() {
      try {
        const res = await fetch('config.json?' + Date.now()); // é˜²ç¼“å­˜
        CONFIG = await res.json();
        
        // æ¸²æŸ“ä¸‹æ‹‰èœå•
        const select = document.getElementById('site');
        select.innerHTML = '';
        Object.entries(CONFIG.platforms).forEach(([key, plat]) => {
          const opt = document.createElement('option');
          opt.value = key;
          opt.textContent = plat.name;
          select.appendChild(opt);
        });
        const customOpt = document.createElement('option');
        customOpt.value = 'custom';
        customOpt.textContent = 'è‡ªå®šä¹‰';
        select.appendChild(customOpt);
        
        select.disabled = false;
        document.getElementById('calcBtn').disabled = false;
      } catch (err) {
        alert('âŒ æ— æ³•åŠ è½½ config.json\nè¯·ç¡®ä¿è¯¥æ–‡ä»¶å­˜åœ¨äºä»“åº“æ ¹ç›®å½•');
        console.error(err);
      }
    }

    function getThailandShipping(weight) {
      const base = CONFIG.shipping.th_cross_base;
      if (weight <= 100) return base["100"];
      if (weight <= 200) return base["200"];
      if (weight <= 500) return base["500"];
      return base["1000"];
    }

    document.getElementById('site').addEventListener('change', e => {
      document.getElementById('custom-fields').style.display = e.target.value === 'custom' ? 'block' : 'none';
    });

    function calculate() {
      if (!CONFIG) { alert('é…ç½®æœªåŠ è½½å®Œæˆ'); return; }
      
      const site = document.getElementById('site').value;
      let commission=0, fee=0, serviceFee=0, exchangeRate=1, shippingRMB=0;
      const weight = parseFloat(document.getElementById('weight').value) || 100;

      if (site !== 'custom') {
        const plat = CONFIG.platforms[site];
        if (!plat) return;
        ({commission, fee, serviceFee, exchangeRate} = plat);
        
        if (plat.shippingType === 'vn') {
          const tier = CONFIG.shipping.vn_tiers.find(([w]) => weight <= w);
          const vnShip = tier ? tier[1] : 11000;
          shippingRMB = vnShip / 3700;
        } else if (plat.shippingType === 'th_cross') {
          shippingRMB = getThailandShipping(weight);
        } else if (plat.shippingType === 'th_local') {
          shippingRMB = 1.0;
        }
      } else {
        commission = parseFloat(document.getElementById('commission').value) || 0;
        fee = parseFloat(document.getElementById('fee').value) || 0;
        serviceFee = parseFloat(document.getElementById('serviceFee').value) || 0;
        exchangeRate = parseFloat(document.getElementById('exchange').value) || 1;
        shippingRMB = parseFloat(document.getElementById('shipping').value) || 0;
      }

      const totalRate = (commission + fee + serviceFee) / 100;
      if (totalRate >= 1) { alert("å¹³å°è´¹ç‡ä¸èƒ½ â‰¥ 100%"); return; }

      const cost = parseFloat(document.getElementById('cost').value) || 0;
      const packaging = parseFloat(document.getElementById('packaging').value) || 0;
      const profit = parseFloat(document.getElementById('profit').value) || 0;
      const marketing = parseFloat(document.getElementById('marketing').value) || 0;

      const totalCost = cost + shippingRMB + packaging;
      const targetNet = totalCost * (1 + profit / 100);
      let finalRMB = (targetNet + marketing) / (1 - totalRate);
      finalRMB = Math.ceil(finalRMB) - 0.01;
      if (finalRMB < 0) finalRMB = 0;

      const localVal = finalRMB * exchangeRate;
      const currency = site.includes('vn') ? 'VND' : 'THB';
      const localStr = currency === 'VND' ? Math.round(localVal).toLocaleString() : localVal.toFixed(0);

      document.getElementById('totalCost').textContent = totalCost.toFixed(2) + ' å…ƒ';
      document.getElementById('targetNet').textContent = targetNet.toFixed(2) + ' å…ƒ';
      document.getElementById('finalPriceRMB').textContent = finalRMB.toFixed(2) + ' å…ƒ';
      document.getElementById('localPrice').textContent = ` $ {localStr}  $ {currency}`;

      document.getElementById('result-placeholder').style.display = 'none';
      document.getElementById('result-box').style.display = 'block';
    }

    // å¯åŠ¨
    loadConfig();
  </script>
</body>
</html>
